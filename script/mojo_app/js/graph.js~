
let radius = 16;
let vertex_radius = 16;
let image_size = 500;

let recolor_percentage = 5;

let edge_color = [];

// -----------------------------------------------------------------------

function setup() {
  let myCanvas = createCanvas(image_size, image_size);
  myCanvas.parent('graph_div');
  draw_coin();
  draw_bit();
}

// -----------------------------------------------------------------------

function draw() {
  if ( mouseIsPressed ) {
      main();
    } else {
      draw_coin();
      draw_bit();
    }
}

// -----------------------------------------------------------------------

function main() {
  // background(255,0,255);
  // background(random_color());
  background(255);

  g = getGraph();
  output_graph(g);
}
// -----------------------------------------------------------------------

function random_color() {
  return [ random(255), random(255), random(255) ];
}
// -----------------------------------------------------------------------

function onlyUnique(value, index, self) {
    return self.indexOf(value) === index;
}

// -----------------------------------------------------------------------

function output_graph(g) {
    let edge_refs = g.split(',');
    let vertex_refs = g.split(/\D+/);
    let uniq_vertices = vertex_refs.filter(onlyUnique);
    let v = uniq_vertices.length;

    // Compute angle between vertices
    let angle_between_vertices = PI * 2 / v;

    // Compute Center of image
    let x_center = image_size / 2;
    let y_center = x_center;
    let border   = 0; //parseInt( image_size / 25 );  // cellpadding in the image

    // Compute vertex coordinates
    let radius   = ( image_size / 2 ) - border;
    let angle    = Math.PI * ( 0.5 - ( 1 / v ) );
    let vertices = uniq_vertices.sort();

    let vertex_coordinates = [];
    for ( let i = 0; i < v; i++ ) {
      let vertex = vertices[i];
      let x = ( radius * cos(angle) ) + x_center;
      let y = ( radius * sin(angle) ) + y_center;
      vertex_coordinates[vertex] = { "x": x, "y": y };
      angle += angle_between_vertices;

      // draw_vertex(x,y);
    }

    draw_edges(vertex_coordinates,edge_refs);
    draw_bit();
}

// -----------------------------------------------------------------------

function draw_bit() {
  stroke(0);
  fill(0);
  rect(0,0,image_size/2,image_size);
}

// -----------------------------------------------------------------------

function draw_coin() {
  stroke(255,0,0);
  fill(255,0,0);
  let r = image_size / 2;
  ellipse(r,r,image_size,image_size);
}

// -----------------------------------------------------------------------

function draw_edges(vertex_coordinates,edge_refs) {

  for( let j = 0; j < edge_refs.length; j++ ) {

    let edge_ref = edge_refs[j].split('=');

    let v1 = edge_ref[0];
    let v2 = edge_ref[1];

    let x1 = vertex_coordinates[ v1 ].x;
    let y1 = vertex_coordinates[ v1 ].y;
    let x2 = vertex_coordinates[ v2 ].x;
    let y2 = vertex_coordinates[ v2 ].y;

    let e_color;
    if ( random(100) > recolor_percentage ) {
      if (( edge_color !== undefined )
          && ( edge_color[ v1 ] !== undefined )
          && ( edge_color[ v1 ][ v2 ] !== undefined )
        ){
        // preserve color
        e_color = edge_color[ v1 ][ v2 ];
      }
    }

    if ( e_color === undefined ) {
      // no color to preserve
      e_color = get_edge_color(v1, v2);
    }

    stroke( e_color );
    line( x1, y1, x2, y2 );
  }

}

// -----------------------------------------------------------------------

function get_edge_color(v1,v2) {
  let e_color = random_color();
  if ( (edge_color === undefined) || (edge_color[ v1 ] === undefined )) {
    edge_color[ v1 ] = [];
  }
  edge_color[ v1 ][ v2 ] = e_color;
  return e_color;
}


// -----------------------------------------------------------------------

function draw_vertex(x,y) {
  // TODO: Add vertex labels
  // Draw vertex
  stroke(0);
  fill(255);
  ellipse(x,y,vertex_radius,vertex_radius);
}

// -----------------------------------------------------------------------

function getGraph() {
  // g = '3=6,3=9,6=9';
  // g= '11=23,11=32,12=24,12=31,12=33,13=21,13=25,13=32,13=34,14=22,14=26,14=33,14=35,15=23,15=27,15=34,15=36,16=24,16=28,16=35,16=37,17=25,17=36,17=38,18=26,18=37,21=33,21=42,22=34,22=41,22=43,23=31,23=35,23=42,23=44,24=32,24=36,24=43,24=45,25=33,25=37,25=44,25=46,26=34,26=38,26=45,26=47,27=35,27=46,27=48,28=36,28=47,31=43,31=52,32=44,32=51,32=53,33=41,33=45,33=52,33=54,34=42,34=46,34=53,34=55,35=43,35=47,35=54,35=56,36=44,36=48,36=55,36=57,37=45,37=56,37=58,38=46,38=57,41=53,41=62,42=54,42=61,42=63,43=51,43=55,43=62,43=64,44=52,44=56,44=63,44=65,45=53,45=57,45=64,45=66,46=54,46=58,46=65,46=67,47=55,47=66,47=68,48=56,48=67,51=63,51=72,52=64,52=71,52=73,53=61,53=65,53=72,53=74,54=62,54=66,54=73,54=75,55=63,55=67,55=74,55=76,56=64,56=68,56=75,56=77,57=65,57=76,57=78,58=66,58=77,61=73,61=82,62=74,62=81,62=83,63=71,63=75,63=82,63=84,64=72,64=76,64=83,64=85,65=73,65=77,65=84,65=86,66=74,66=78,66=85,66=87,67=75,67=86,67=88,68=76,68=87,71=83,72=84,73=81,73=85,74=82,74=86,75=83,75=87,76=84,76=8';

  g = '0=1,0=10,0=11,0=12,0=13,0=15,0=16,0=17,0=18,0=19,0=2,0=20,0=21,0=22,0=23,0=24,0=25,0=26,0=27,0=28,0=29,0=3,0=31,0=32,0=33,0=34,0=35,0=36,0=37,0=38,0=4,0=5,0=6,0=8,0=9,10=11,10=12,10=13,10=14,10=15,10=16,10=17,10=18,10=19,10=2,10=20,10=21,10=23,10=24,10=25,10=26,10=27,10=28,10=29,10=3,10=30,10=31,10=32,10=33,10=34,10=36,10=37,10=38,10=39,10=4,10=5,10=6,10=7,10=8,11=12,11=13,11=14,11=15,11=16,11=17,11=18,11=2,11=20,11=21,11=23,11=24,11=25,11=26,11=27,11=28,11=30,11=31,11=32,11=33,11=34,11=35,11=36,11=38,11=39,11=4,11=5,11=6,11=7,11=8,11=9,12=13,12=14,12=15,12=16,12=17,12=18,12=2,12=20,12=21,12=22,12=23,12=24,12=25,12=26,12=27,12=28,12=29,12=3,12=30,12=31,12=32,12=33,12=34,12=35,12=36,12=37,12=38,12=39,12=4,12=5,12=6,12=8,12=9,13=14,13=15,13=16,13=17,13=18,13=19,13=2,13=20,13=21,13=22,13=24,13=25,13=26,13=27,13=28,13=29,13=3,13=30,13=32,13=33,13=34,13=35,13=36,13=37,13=38,13=39,13=4,13=6,13=8,13=9,14=15,14=16,14=17,14=18,14=19,14=2,14=20,14=21,14=22,14=23,14=24,14=25,14=26,14=27,14=28,14=29,14=30,14=31,14=32,14=33,14=34,14=35,14=36,14=37,14=38,14=39,14=4,14=6,14=7,14=8,14=9,15=16,15=17,15=18,15=19,15=2,15=20,15=21,15=22,15=23,15=24,15=26,15=27,15=28,15=29,15=3,15=30,15=31,15=32,15=33,15=34,15=35,15=36,15=37,15=38,15=39,15=4,15=5,15=7,15=8,15=9,16=17,16=18,16=19,16=2,16=21,16=23,16=24,16=25,16=26,16=27,16=28,16=29,16=3,16=30,16=31,16=32,16=34,16=35,16=36,16=37,16=38,16=39,16=4,16=5,16=6,16=7,16=8,16=9,17=18,17=19,17=20,17=21,17=22,17=23,17=24,17=25,17=26,17=29,17=3,17=31,17=32,17=34,17=35,17=36,17=37,17=38,17=39,17=4,17=5,17=6,17=7,17=8,17=9,18=19,18=2,18=21,18=22,18=23,18=24,18=25,18=26,18=27,18=28,18=29,18=3,18=30,18=31,18=32,18=33,18=34,18=35,18=36,18=37,18=38,18=39,18=4,18=5,18=6,18=7,18=8,18=9,19=2,19=20,19=21,19=22,19=24,19=25,19=26,19=27,19=28,19=29,19=3,19=30,19=31,19=32,19=33,19=34,19=35,19=36,19=37,19=38,19=39,19=5,19=6,19=7,19=8,19=9,1=10,1=12,1=13,1=14,1=15,1=16,1=17,1=18,1=2,1=21,1=22,1=23,1=24,1=25,1=26,1=27,1=28,1=29,1=3,1=30,1=31,1=32,1=33,1=34,1=35,1=36,1=37,1=38,1=39,1=4,1=5,1=6,1=7,1=8,1=9,20=22,20=23,20=24,20=25,20=26,20=27,20=28,20=29,20=3,20=30,20=31,20=32,20=33,20=34,20=35,20=36,20=37,20=39,20=4,20=5,20=6,20=8,20=9,21=22,21=23,21=24,21=25,21=26,21=27,21=28,21=29,21=3,21=30,21=31,21=32,21=33,21=34,21=35,21=36,21=38,21=39,21=4,21=5,21=8,21=9,22=23,22=27,22=28,22=29,22=3,22=30,22=31,22=32,22=33,22=35,22=37,22=38,22=39,22=4,22=5,22=6,22=7,22=8,22=9,23=24,23=25,23=26,23=27,23=28,23=29,23=3,23=30,23=31,23=32,23=33,23=34,23=35,23=36,23=37,23=38,23=39,23=4,23=5,23=7,23=8,23=9,24=25,24=26,24=27,24=28,24=3,24=30,24=31,24=32,24=33,24=34,24=35,24=36,24=38,24=39,24=4,24=6,24=7,24=9,25=26,25=29,25=3,25=30,25=32,25=33,25=34,25=35,25=37,25=38,25=39,25=5,25=6,25=7,25=8,25=9,26=27,26=28,26=29,26=3,26=31,26=32,26=33,26=34,26=35,26=36,26=37,26=38,26=4,26=5,26=6,26=8,26=9,27=28,27=29,27=3,27=30,27=31,27=32,27=33,27=34,27=35,27=36,27=37,27=38,27=39,27=4,27=5,27=6,27=7,27=9,28=3,28=30,28=31,28=32,28=33,28=34,28=35,28=36,28=37,28=38,28=39,28=4,28=5,28=6,28=8,28=9,29=3,29=30,29=31,29=32,29=33,29=34,29=35,29=36,29=37,29=38,29=39,29=4,29=5,29=6,29=7,29=9,2=20,2=21,2=22,2=23,2=24,2=25,2=26,2=27,2=28,2=29,2=3,2=30,2=31,2=32,2=34,2=35,2=36,2=37,2=38,2=39,2=4,2=5,2=7,2=8,2=9,30=31,30=33,30=34,30=35,30=36,30=37,30=38,30=39,30=4,30=5,30=6,30=7,30=8,30=9,31=32,31=33,31=34,31=36,31=37,31=38,31=39,31=5,31=6,31=7,31=8,31=9,32=33,32=34,32=36,32=37,32=38,32=39,32=4,32=7,32=8,33=34,33=35,33=36,33=37,33=39,33=4,33=5,33=6,33=7,33=8,33=9,34=35,34=36,34=37,34=38,34=39,34=4,34=5,34=7,34=8,34=9,35=36,35=37,35=38,35=4,35=5,35=6,35=7,35=8,35=9,36=38,36=39,36=4,36=5,36=6,36=7,36=8,36=9,37=38,37=39,37=4,37=5,37=6,37=7,37=8,38=39,38=4,38=5,38=6,38=7,38=8,39=4,39=5,39=6,39=7,39=8,39=9,3=30,3=31,3=32,3=34,3=35,3=36,3=37,3=38,3=39,3=4,3=5,3=6,3=7,3=8,3=9,4=5,4=6,4=7,4=8,4=9,5=6,5=7,5=8,5=9,6=7,6=8,6=9,7=8,7=9,8=9';
  return g;
}
